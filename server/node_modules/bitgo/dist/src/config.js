"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _ = require("lodash");
var environments_1 = require("./v2/environments");
var statics_1 = require("@bitgo/statics");
// Get the list of ERC-20 tokens from statics and format it properly
var formattedErc20Tokens = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.Erc20Coin) {
        acc.push({
            type: coin.name,
            coin: coin.network.type === "mainnet" /* MAINNET */ ? 'eth' : 'teth',
            network: coin.network.type === "mainnet" /* MAINNET */ ? 'Mainnet' : 'Testnet',
            name: coin.fullName,
            tokenContractAddress: coin.contractAddress.toString().toLowerCase(),
            decimalPlaces: coin.decimalPlaces,
        });
    }
    return acc;
}, []);
// Get the list of Stellar tokens from statics and format it properly
var formattedStellarTokens = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.StellarCoin) {
        acc.push({
            type: coin.name,
            coin: coin.network.type === "mainnet" /* MAINNET */ ? 'xlm' : 'txlm',
            network: coin.network.type === "mainnet" /* MAINNET */ ? 'Mainnet' : 'Testnet',
            name: coin.fullName,
            decimalPlaces: coin.decimalPlaces,
        });
    }
    return acc;
}, []);
// Get the list of OFC tokens from statics and format it properly
var formattedOfcCoins = statics_1.coins.reduce(function (acc, coin) {
    if (coin instanceof statics_1.OfcCoin) {
        acc.push({
            type: coin.name,
            coin: 'ofc',
            backingCoin: coin.asset,
            name: coin.fullName,
            decimalPlaces: coin.decimalPlaces,
            isFiat: coin.kind === "fiat" /* FIAT */,
        });
    }
    return acc;
}, []);
exports.tokens = {
    // network name for production environments
    bitcoin: {
        eth: {
            tokens: formattedErc20Tokens.filter(function (token) { return token.network === 'Mainnet'; }),
        },
        xlm: {
            tokens: formattedStellarTokens.filter(function (token) { return token.network === 'Mainnet'; }),
        },
        ofc: {
            tokens: formattedOfcCoins.filter(function (token) { return statics_1.coins.get(token.type).network.type === "mainnet" /* MAINNET */; }),
        },
    },
    // network name for test environments
    testnet: {
        eth: {
            tokens: formattedErc20Tokens.filter(function (token) { return token.network === 'Testnet'; }),
        },
        xlm: {
            tokens: formattedStellarTokens.filter(function (token) { return token.network === 'Testnet'; }),
        },
        ofc: {
            tokens: formattedOfcCoins.filter(function (token) { return statics_1.coins.get(token.type).network.type === "testnet" /* TESTNET */; }),
        },
    },
};
/**
 * Verify mainnet or testnet tokens
 * @param tokens
 */
var verifyTokens = function (tokens) {
    var verifiedTokens = {};
    _.forEach(tokens, function (token) {
        if (verifiedTokens[token.type]) {
            throw new Error('token : ' + token.type + ' duplicated.');
        }
        verifiedTokens[token.type] = true;
        if (token.tokenContractAddress && token.tokenContractAddress !== _.toLower(token.tokenContractAddress)) {
            throw new Error('token contract: ' + token.type + ' is not all lower case: ' + token.tokenContractAddress);
        }
    });
    return verifiedTokens;
};
var mainnetErc20Tokens = verifyTokens(exports.tokens.bitcoin.eth.tokens);
var mainnetStellarTokens = verifyTokens(exports.tokens.bitcoin.xlm.tokens);
exports.mainnetTokens = _.assign({}, mainnetErc20Tokens, mainnetStellarTokens);
var testnetErc20Tokens = verifyTokens(exports.tokens.testnet.eth.tokens);
var testnetStellarTokens = verifyTokens(exports.tokens.testnet.xlm.tokens);
exports.testnetTokens = _.assign({}, testnetErc20Tokens, testnetStellarTokens);
exports.defaults = {
    maxFee: 0.1e8,
    maxFeeRate: 1000000,
    minFeeRate: 5000,
    fallbackFeeRate: 50000,
    minOutputSize: 2730,
    minInstantFeeRate: 10000,
    bitgoEthAddress: '0x0f47ea803926926f299b7f1afc8460888d850f47'
};
// Supported cross-chain recovery routes. The coin to be recovered is the index, the valid coins for recipient wallets
// are listed in the array.
exports.supportedCrossChainRecoveries = {
    btc: ['bch', 'ltc', 'bsv'],
    bch: ['btc', 'ltc', 'bsv'],
    ltc: ['btc', 'bch', 'bsv'],
    bsv: ['btc', 'ltc', 'bch']
};
// KRS providers and their fee structures
exports.krsProviders = {
    keyternal: {
        feeType: 'flatUsd',
        feeAmount: 99,
        supportedCoins: ['btc', 'eth'],
        feeAddresses: {
            btc: '' // TODO [BG-6965] Get address from Keyternal - recovery will fail for now until Keyternal is ready
        }
    },
    bitgoKRSv2: {
        feeType: 'flatUsd',
        feeAmount: 0,
        supportedCoins: ['btc', 'eth']
    },
    dai: {
        feeType: 'flatUsd',
        feeAmount: 0,
        supportedCoins: ['btc', 'eth', 'xlm', 'xrp', 'dash', 'zec', 'ltc', 'bch']
    }
};
exports.bitcoinAverageBaseUrl = 'https://apiv2.bitcoinaverage.com/indices/local/ticker/';
// TODO: once server starts returning eth address keychains, remove bitgoEthAddress
/**
 * Get the default (hardcoded) constants for a particular network.
 *
 * Note that this may not be the complete set of constants, and additional constants may get fetched
 * from BitGo during the lifespan of a BitGo object.
 * @param env
 */
exports.defaultConstants = function (env) {
    if (environments_1.Environments[env] === undefined) {
        throw Error("invalid environment " + env);
    }
    var network = environments_1.Environments[env].network;
    return _.merge({}, exports.defaults, exports.tokens[network]);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDBCQUE0QjtBQUM1QixrREFBa0U7QUFJbEUsMENBQStGO0FBMkIvRixvRUFBb0U7QUFDcEUsSUFBTSxvQkFBb0IsR0FBRyxlQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBdUIsRUFBRSxJQUFJO0lBQ3RFLElBQUksSUFBSSxZQUFZLG1CQUFTLEVBQUU7UUFDN0IsR0FBRyxDQUFDLElBQUksQ0FBQztZQUNQLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksNEJBQXdCLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTTtZQUNoRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLDRCQUF3QixDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVM7WUFDMUUsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ25CLG9CQUFvQixFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUMsV0FBVyxFQUFFO1lBQ25FLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYTtTQUNsQyxDQUFDLENBQUM7S0FDSjtJQUNELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBRVAscUVBQXFFO0FBQ3JFLElBQU0sc0JBQXNCLEdBQUcsZUFBSyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQXlCLEVBQUUsSUFBSTtJQUMxRSxJQUFJLElBQUksWUFBWSxxQkFBVyxFQUFFO1FBQy9CLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDUCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLDRCQUF3QixDQUFDLENB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QUFLLFNBQVMsRUFBRTtRQUNuQyxNQUFNLEtBQUssQ0FBQyx5QkFBdUIsR0FBSyxDQUFDLENBQUM7S0FDM0M7SUFFRCxJQUFNLE9BQU8sR0FBRywyQkFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUMxQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLGdCQUFRLEVBQUUsY0FBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDaEQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgRW52aXJvbm1lbnRzLCBFbnZpcm9ubWVudE5hbWUgfSBmcm9tICcuL3YyL2Vudmlyb25tZW50cyc7XG5pbXBvcnQgeyBPZmNUb2tlbkNvbmZpZyB9IGZyb20gJy4vdjIvY29pbnMvb2ZjVG9rZW4nO1xuaW1wb3J0IHsgRXJjMjBUb2tlbkNvbmZpZyB9IGZyb20gJy4vdjIvY29pbnMvZXJjMjBUb2tlbic7XG5pbXBvcnQgeyBTdGVsbGFyVG9rZW5Db25maWcgfSBmcm9tICcuL3YyL2NvaW5zL3N0ZWxsYXJUb2tlbic7XG5pbXBvcnQgeyBjb2lucywgRXJjMjBDb2luLCBTdGVsbGFyQ29pbiwgT2ZjQ29pbiwgQ29pbktpbmQsIE5ldHdvcmtUeXBlIH0gZnJvbSAnQGJpdGdvL3N0YXRpY3MnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRva2VucyB7XG4gIGJpdGNvaW46IHtcbiAgICBldGg6IHtcbiAgICAgIHRva2VuczogRXJjMjBUb2tlbkNvbmZpZ1tdO1xuICAgIH07XG4gICAgeGxtOiB7XG4gICAgICB0b2tlbnM6IFN0ZWxsYXJUb2tlbkNvbmZpZ1tdO1xuICAgIH07XG4gICAgb2ZjOiB7XG4gICAgICB0b2tlbnM6IE9mY1Rva2VuQ29uZmlnW107XG4gICAgfTtcbiAgfTtcbiAgdGVzdG5ldDoge1xuICAgIGV0aDoge1xuICAgICAgdG9rZW5zOiBFcmMyMFRva2VuQ29uZmlnW107XG4gICAgfTtcbiAgICB4bG06IHtcbiAgICAgIHRva2VuczogU3RlbGxhclRva2VuQ29uZmlnW107XG4gICAgfTtcbiAgICBvZmM6IHtcbiAgICAgIHRva2VuczogT2ZjVG9rZW5Db25maWdbXTtcbiAgICB9O1xuICB9O1xufVxuXG4vLyBHZXQgdGhlIGxpc3Qgb2YgRVJDLTIwIHRva2VucyBmcm9tIHN0YXRpY3MgYW5kIGZvcm1hdCBpdCBwcm9wZXJseVxuY29uc3QgZm9ybWF0dGVkRXJjMjBUb2tlbnMgPSBjb2lucy5yZWR1Y2UoKGFjYzogRXJjMjBUb2tlbkNvbmZpZ1tdLCBjb2luKSA9PiB7XG4gIGlmIChjb2luIGluc3RhbmNlb2YgRXJjMjBDb2luKSB7XG4gICAgYWNjLnB1c2goe1xuICAgICAgdHlwZTogY29pbi5uYW1lLFxuICAgICAgY29pbjogY29pbi5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLk1BSU5ORVQgPyAnZXRoJyA6ICd0ZXRoJyxcbiAgICAgIG5ldHdvcms6IGNvaW4ubmV0d29yay50eXBlID09PSBOZXR3b3JrVHlwZS5NQUlOTkVUID8gJ01haW5uZXQnIDogJ1Rlc3RuZXQnLFxuICAgICAgbmFtZTogY29pbi5mdWxsTmFtZSxcbiAgICAgIHRva2VuQ29udHJhY3RBZGRyZXNzOiBjb2luLmNvbnRyYWN0QWRkcmVzcy50b1N0cmluZygpLnRvTG93ZXJDYXNlKCksXG4gICAgICBkZWNpbWFsUGxhY2VzOiBjb2luLmRlY2ltYWxQbGFjZXMsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGFjYztcbn0sIFtdKTtcblxuLy8gR2V0IHRoZSBsaXN0IG9mIFN0ZWxsYXIgdG9rZW5zIGZyb20gc3RhdGljcyBhbmQgZm9ybWF0IGl0IHByb3Blcmx5XG5jb25zdCBmb3JtYXR0ZWRTdGVsbGFyVG9rZW5zID0gY29pbnMucmVkdWNlKChhY2M6IFN0ZWxsYXJUb2tlbkNvbmZpZ1tdLCBjb2luKSA9PiB7XG4gIGlmIChjb2luIGluc3RhbmNlb2YgU3RlbGxhckNvaW4pIHtcbiAgICBhY2MucHVzaCh7XG4gICAgICB0eXBlOiBjb2luLm5hbWUsXG4gICAgICBjb2luOiBjb2luLm5ldHdvcmsudHlwZSA9PT0gTmV0d29ya1R5cGUuTUFJTk5FVCA/ICd4bG0nIDogJ3R4bG0nLFxuICAgICAgbmV0d29yazogY29pbi5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLk1BSU5ORVQgPyAnTWFpbm5ldCcgOiAnVGVzdG5ldCcsXG4gICAgICBuYW1lOiBjb2luLmZ1bGxOYW1lLFxuICAgICAgZGVjaW1hbFBsYWNlczogY29pbi5kZWNpbWFsUGxhY2VzLFxuICAgIH0pO1xuICB9XG4gIHJldHVybiBhY2M7XG59LCBbXSk7XG5cbi8vIEdldCB0aGUgbGlzdCBvZiBPRkMgdG9rZW5zIGZyb20gc3RhdGljcyBhbmQgZm9ybWF0IGl0IHByb3Blcmx5XG5jb25zdCBmb3JtYXR0ZWRPZmNDb2lucyA9IGNvaW5zLnJlZHVjZSgoYWNjOiBPZmNUb2tlbkNvbmZpZ1tdLCBjb2luKSA9PiB7XG4gIGlmIChjb2luIGluc3RhbmNlb2YgT2ZjQ29pbikge1xuICAgIGFjYy5wdXNoKHtcbiAgICAgIHR5cGU6IGNvaW4ubmFtZSxcbiAgICAgIGNvaW46ICdvZmMnLFxuICAgICAgYmFja2luZ0NvaW46IGNvaW4uYXNzZXQsXG4gICAgICBuYW1lOiBjb2luLmZ1bGxOYW1lLFxuICAgICAgZGVjaW1hbFBsYWNlczogY29pbi5kZWNpbWFsUGxhY2VzLFxuICAgICAgaXNGaWF0OiBjb2luLmtpbmQgPT09IENvaW5LaW5kLkZJQVQsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGFjYztcbn0sIFtdKTtcblxuZXhwb3J0IGNvbnN0IHRva2VuczogVG9rZW5zID0ge1xuICAvLyBuZXR3b3JrIG5hbWUgZm9yIHByb2R1Y3Rpb24gZW52aXJvbm1lbnRzXG4gIGJpdGNvaW46IHtcbiAgICBldGg6IHtcbiAgICAgIHRva2VuczogZm9ybWF0dGVkRXJjMjBUb2tlbnMuZmlsdGVyKHRva2VuID0+IHRva2VuLm5ldHdvcmsgPT09ICdNYWlubmV0JyksXG4gICAgfSxcbiAgICB4bG06IHtcbiAgICAgIHRva2VuczogZm9ybWF0dGVkU3RlbGxhclRva2Vucy5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubmV0d29yayA9PT0gJ01haW5uZXQnKSxcbiAgICB9LFxuICAgIG9mYzoge1xuICAgICAgdG9rZW5zOiBmb3JtYXR0ZWRPZmNDb2lucy5maWx0ZXIodG9rZW4gPT4gY29pbnMuZ2V0KHRva2VuLnR5cGUpLm5ldHdvcmsudHlwZSA9PT0gTmV0d29ya1R5cGUuTUFJTk5FVCksXG4gICAgfSxcbiAgfSxcbiAgLy8gbmV0d29yayBuYW1lIGZvciB0ZXN0IGVudmlyb25tZW50c1xuICB0ZXN0bmV0OiB7XG4gICAgZXRoOiB7XG4gICAgICB0b2tlbnM6IGZvcm1hdHRlZEVyYzIwVG9rZW5zLmZpbHRlcih0b2tlbiA9PiB0b2tlbi5uZXR3b3JrID09PSAnVGVzdG5ldCcpLFxuICAgIH0sXG4gICAgeGxtOiB7XG4gICAgICB0b2tlbnM6IGZvcm1hdHRlZFN0ZWxsYXJUb2tlbnMuZmlsdGVyKHRva2VuID0+IHRva2VuLm5ldHdvcmsgPT09ICdUZXN0bmV0JyksXG4gICAgfSxcbiAgICBvZmM6IHtcbiAgICAgIHRva2VuczogZm9ybWF0dGVkT2ZjQ29pbnMuZmlsdGVyKHRva2VuID0+IGNvaW5zLmdldCh0b2tlbi50eXBlKS5uZXR3b3JrLnR5cGUgPT09IE5ldHdvcmtUeXBlLlRFU1RORVQpLFxuICAgIH0sXG4gIH0sXG59O1xuXG4vKipcbiAqIFZlcmlmeSBtYWlubmV0IG9yIHRlc3RuZXQgdG9rZW5zXG4gKiBAcGFyYW0gdG9rZW5zXG4gKi9cbmNvbnN0IHZlcmlmeVRva2VucyA9IGZ1bmN0aW9uKHRva2Vucykge1xuICBjb25zdCB2ZXJpZmllZFRva2VucyA9IHt9O1xuICBfLmZvckVhY2godG9rZW5zLCBmdW5jdGlvbih0b2tlbikge1xuICAgIGlmICh2ZXJpZmllZFRva2Vuc1t0b2tlbi50eXBlXSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd0b2tlbiA6ICcgKyB0b2tlbi50eXBlICsgJyBkdXBsaWNhdGVkLicpO1xuICAgIH1cbiAgICB2ZXJpZmllZFRva2Vuc1t0b2tlbi50eXBlXSA9IHRydWU7XG5cbiAgICBpZiAodG9rZW4udG9rZW5Db250cmFjdEFkZHJlc3MgJiYgdG9rZW4udG9rZW5Db250cmFjdEFkZHJlc3MgIT09IF8udG9Mb3dlcih0b2tlbi50b2tlbkNvbnRyYWN0QWRkcmVzcykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndG9rZW4gY29udHJhY3Q6ICcgKyB0b2tlbi50eXBlICsgJyBpcyBub3QgYWxsIGxvd2VyIGNhc2U6ICcgKyB0b2tlbi50b2tlbkNvbnRyYWN0QWRkcmVzcyk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHZlcmlmaWVkVG9rZW5zO1xufTtcblxuY29uc3QgbWFpbm5ldEVyYzIwVG9rZW5zID0gdmVyaWZ5VG9rZW5zKHRva2Vucy5iaXRjb2luLmV0aC50b2tlbnMpO1xuY29uc3QgbWFpbm5ldFN0ZWxsYXJUb2tlbnMgPSB2ZXJpZnlUb2tlbnModG9rZW5zLmJpdGNvaW4ueGxtLnRva2Vucyk7XG5leHBvcnQgY29uc3QgbWFpbm5ldFRva2VucyA9IF8uYXNzaWduKHt9LCBtYWlubmV0RXJjMjBUb2tlbnMsIG1haW5uZXRTdGVsbGFyVG9rZW5zKTtcblxuY29uc3QgdGVzdG5ldEVyYzIwVG9rZW5zID0gdmVyaWZ5VG9rZW5zKHRva2Vucy50ZXN0bmV0LmV0aC50b2tlbnMpO1xuY29uc3QgdGVzdG5ldFN0ZWxsYXJUb2tlbnMgPSB2ZXJpZnlUb2tlbnModG9rZW5zLnRlc3RuZXQueGxtLnRva2Vucyk7XG5leHBvcnQgY29uc3QgdGVzdG5ldFRva2VucyA9IF8uYXNzaWduKHt9LCB0ZXN0bmV0RXJjMjBUb2tlbnMsIHRlc3RuZXRTdGVsbGFyVG9rZW5zKTtcblxuXG5leHBvcnQgY29uc3QgZGVmYXVsdHMgPSB7XG4gIG1heEZlZTogMC4xZTgsXG4gIG1heEZlZVJhdGU6IDEwMDAwMDAsXG4gIG1pbkZlZVJhdGU6IDUwMDAsXG4gIGZhbGxiYWNrRmVlUmF0ZTogNTAwMDAsXG4gIG1pbk91dHB1dFNpemU6IDI3MzAsXG4gIG1pbkluc3RhbnRGZWVSYXRlOiAxMDAwMCxcbiAgYml0Z29FdGhBZGRyZXNzOiAnMHgwZjQ3ZWE4MDM5MjY5MjZmMjk5YjdmMWFmYzg0NjA4ODhkODUwZjQ3J1xufTtcblxuLy8gU3VwcG9ydGVkIGNyb3NzLWNoYWluIHJlY292ZXJ5IHJvdXRlcy4gVGhlIGNvaW4gdG8gYmUgcmVjb3ZlcmVkIGlzIHRoZSBpbmRleCwgdGhlIHZhbGlkIGNvaW5zIGZvciByZWNpcGllbnQgd2FsbGV0c1xuLy8gYXJlIGxpc3RlZCBpbiB0aGUgYXJyYXkuXG5leHBvcnQgY29uc3Qgc3VwcG9ydGVkQ3Jvc3NDaGFpblJlY292ZXJpZXMgPSB7XG4gIGJ0YzogWydiY2gnLCAnbHRjJywgJ2JzdiddLFxuICBiY2g6IFsnYnRjJywgJ2x0YycsICdic3YnXSxcbiAgbHRjOiBbJ2J0YycsICdiY2gnLCAnYnN2J10sXG4gIGJzdjogWydidGMnLCAnbHRjJywgJ2JjaCddXG59O1xuXG4vLyBLUlMgcHJvdmlkZXJzIGFuZCB0aGVpciBmZWUgc3RydWN0dXJlc1xuZXhwb3J0IGNvbnN0IGtyc1Byb3ZpZGVycyA9IHtcbiAga2V5dGVybmFsOiB7XG4gICAgZmVlVHlwZTogJ2ZsYXRVc2QnLFxuICAgIGZlZUFtb3VudDogOTksXG4gICAgc3VwcG9ydGVkQ29pbnM6IFsnYnRjJywgJ2V0aCddLFxuICAgIGZlZUFkZHJlc3Nlczoge1xuICAgICAgYnRjOiAnJyAvLyBUT0RPIFtCRy02OTY1XSBHZXQgYWRkcmVzcyBmcm9tIEtleXRlcm5hbCAtIHJlY292ZXJ5IHdpbGwgZmFpbCBmb3Igbm93IHVudGlsIEtleXRlcm5hbCBpcyByZWFkeVxuICAgIH1cbiAgfSxcbiAgYml0Z29LUlN2Mjoge1xuICAgIGZlZVR5cGU6ICdmbGF0VXNkJyxcbiAgICBmZWVBbW91bnQ6IDAsIC8vIHdlIHdpbGwgcmVjZWl2ZSBwYXltZW50cyBvZmYtY2hhaW5cbiAgICBzdXBwb3J0ZWRDb2luczogWydidGMnLCAnZXRoJ11cbiAgfSxcbiAgZGFpOiB7XG4gICAgZmVlVHlwZTogJ2ZsYXRVc2QnLFxuICAgIGZlZUFtb3VudDogMCwgLy8gZGFpIHdpbGwgcmVjZWl2ZSBwYXltZW50cyBvZmYtY2hhaW5cbiAgICBzdXBwb3J0ZWRDb2luczogWydidGMnLCAnZXRoJywgJ3hsbScsICd4cnAnLCAnZGFzaCcsICd6ZWMnLCAnbHRjJywgJ2JjaCddXG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBiaXRjb2luQXZlcmFnZUJhc2VVcmwgPSAnaHR0cHM6Ly9hcGl2Mi5iaXRjb2luYXZlcmFnZS5jb20vaW5kaWNlcy9sb2NhbC90aWNrZXIvJztcblxuLy8gVE9ETzogb25jZSBzZXJ2ZXIgc3RhcnRzIHJldHVybmluZyBldGggYWRkcmVzcyBrZXljaGFpbnMsIHJlbW92ZSBiaXRnb0V0aEFkZHJlc3Ncbi8qKlxuICogR2V0IHRoZSBkZWZhdWx0IChoYXJkY29kZWQpIGNvbnN0YW50cyBmb3IgYSBwYXJ0aWN1bGFyIG5ldHdvcmsuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgbWF5IG5vdCBiZSB0aGUgY29tcGxldGUgc2V0IG9mIGNvbnN0YW50cywgYW5kIGFkZGl0aW9uYWwgY29uc3RhbnRzIG1heSBnZXQgZmV0Y2hlZFxuICogZnJvbSBCaXRHbyBkdXJpbmcgdGhlIGxpZmVzcGFuIG9mIGEgQml0R28gb2JqZWN0LlxuICogQHBhcmFtIGVudlxuICovXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbnN0YW50cyA9IChlbnY6IEVudmlyb25tZW50TmFtZSkgPT4ge1xuICBpZiAoRW52aXJvbm1lbnRzW2Vudl0gPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IEVycm9yKGBpbnZhbGlkIGVudmlyb25tZW50ICR7ZW52fWApO1xuICB9XG5cbiAgY29uc3QgbmV0d29yayA9IEVudmlyb25tZW50c1tlbnZdLm5ldHdvcms7XG4gIHJldHVybiBfLm1lcmdlKHt9LCBkZWZhdWx0cywgdG9rZW5zW25ldHdvcmtdKTtcbn07XG4iXX0=