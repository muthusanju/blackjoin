"use strict";
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @prettier
 */
var Bluebird = require("bluebird");
var _ = require("lodash");
var wallet_1 = require("./wallet");
var internal_1 = require("./internal/internal");
var settlements_1 = require("./trading/settlements");
var affirmations_1 = require("./trading/affirmations");
var co = Bluebird.coroutine;
var Enterprise = /** @class */ (function () {
    function Enterprise(bitgo, baseCoin, enterpriseData) {
        this.bitgo = bitgo;
        this.baseCoin = baseCoin;
        if (!_.isObject(enterpriseData)) {
            throw new Error('enterpriseData has to be an object');
        }
        if (!_.isString(enterpriseData.id)) {
            throw new Error('enterprise id has to be a string');
        }
        if (!_.isString(enterpriseData.name)) {
            throw new Error('enterprise name has to be a string');
        }
        this.id = enterpriseData.id;
        this.name = enterpriseData.name;
    }
    /**
     * Enterprise URL for v1 methods, such as getting users
     * @param query
     */
    Enterprise.prototype.url = function (query) {
        if (query === void 0) { query = ''; }
        return this.bitgo.url("/enterprise/" + this.id + query);
    };
    /**
     * Enterprise URL for v2 methods, such as getting fee address balances
     * @param query
     */
    Enterprise.prototype.coinUrl = function (query) {
        if (query === void 0) { query = ''; }
        return this.baseCoin.url("/enterprise/" + this.id + query);
    };
    /**
     * Get the wallets associated with this Enterprise
     * @param params
     * @param callback
     */
    Enterprise.prototype.coinWallets = function (params, callback) {
        if (params === void 0) { params = {}; }
        return co(function coCoinWallets() {
            var walletData;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.bitgo.get(this.baseCoin.url('/wallet/enterprise/' + this.id)).result()];
                    case 1:
                        walletData = _a.sent();
                        walletData.wallets = walletData.wallets.map(function (w) {
                            return new wallet_1.Wallet(_this.bitgo, _this.baseCoin, w);
                        });
                        return [2 /*return*/, walletData];
                }
            });
        })
            .call(this)
            .asCallback(callback);
    };
    /**
     * Get the users associated with this Enterprise
     * @param params
     * @param callback
     */
    Enterprise.prototype.users = function (params, callback) {
        if (params === void 0) { params = {}; }
        return this.bitgo
            .get(this.url('/user'))
            .result()
            .asCallback(callback);
    };
    /**
     * Get the fee address balance for this Enterprise
     * @param params
     * @param callback
     */
    Enterprise.prototype.getFeeAddressBalance = function (params, callback) {
        if (params === void 0) { params = {}; }
        return this.bitgo
            .get(this.coinUrl('/feeAddressBalance'))
            .result()
            .asCallback(callback);
    };
    /**
     * Add a user to this Enterprise
     * @param params
     * @param callback
     */
    Enterprise.prototype.addUser = function (params, callback) {
        if (params === void 0) { params = {}; }
        return this.bitgo
            .post(this.url('/user'))
            .send(params)
            .result()
            .asCallback(callback);
    };
    /**
     * Remove a user from this Enterprise
     * @param params
     * @param callback
     */
    Enterprise.prototype.removeUser = function (params, callback) {
        if (params === void 0) { params = {}; }
        return this.bitgo
            .del(this.url('/user'))
            .send(params)
            .result()
            .asCallback(callback);
    };
    /**
     * Get the first pending transaction for this Enterprise
     * @param params
     * @param callback
     */
    Enterprise.prototype.getFirstPendingTransaction = function (params, callback) {
        if (params === void 0) { params = {}; }
        return internal_1.getFirstPendingTransaction({ enterpriseId: this.id }, this.baseCoin, this.bitgo).asCallback(callback);
    };
    /**
     * Manage settlements for an enterprise
     */
    Enterprise.prototype.settlements = function () {
        return new settlements_1.Settlements(this.bitgo, this.id);
    };
    /**
     * Manage affirmations for an enterprise
     */
    Enterprise.prototype.affirmations = function () {
        return new affirmations_1.Affirmations(this.bitgo, this.id);
    };
    return Enterprise;
}());
exports.Enterprise = Enterprise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50ZXJwcmlzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy92Mi9lbnRlcnByaXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0dBRUc7QUFDSCxtQ0FBcUM7QUFDckMsMEJBQTRCO0FBSTVCLG1DQUFrQztBQUNsQyxnREFBaUU7QUFFakUscURBQW9EO0FBQ3BELHVEQUFzRDtBQUV0RCxJQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDO0FBRTlCO0lBTUUsb0JBQVksS0FBWSxFQUFFLFFBQWtCLEVBQUUsY0FBNEM7UUFDeEYsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUU7WUFDL0IsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1NBQ3ZEO1FBQ0QsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztTQUNyRDtRQUNELElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNwQyxNQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7U0FDdkQ7UUFDRCxJQUFJLENBQUMsRUFBRSxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLElBQUksR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7O09BR0c7SUFDSCx3QkFBRyxHQUFILFVBQUksS0FBa0I7UUFBbEIsc0JBQUEsRUFBQSxVQUFrQjtRQUNwQixPQUFPLElBQUksQ0FBQyxLQUFL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RUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQy9HLENBQUM7SUFFRDs7T0FFRztJQUNILGdDQUFXLEdBQVg7UUFDRSxPQUFPLElBQUkseUJBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxpQ0FBWSxHQUFaO1FBQ0UsT0FBTyxJQUFJLDJCQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUNILGlCQUFDO0FBQUQsQ0FBQyxBQS9IRCxJQStIQztBQS9IWSxnQ0FBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHByZXR0aWVyXG4gKi9cbmltcG9ydCAqIGFzIEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IEJpdEdvIH0gZnJvbSAnLi4vYml0Z28nO1xuaW1wb3J0IHsgQmFzZUNvaW4gfSBmcm9tICcuL2Jhc2VDb2luJztcbmltcG9ydCB7IE5vZGVDYWxsYmFjayB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgV2FsbGV0IH0gZnJvbSAnLi93YWxsZXQnO1xuaW1wb3J0IHsgZ2V0Rmlyc3RQZW5kaW5nVHJhbnNhY3Rpb24gfSBmcm9tICcuL2ludGVybmFsL2ludGVybmFsJztcblxuaW1wb3J0IHsgU2V0dGxlbWVudHMgfSBmcm9tICcuL3RyYWRpbmcvc2V0dGxlbWVudHMnO1xuaW1wb3J0IHsgQWZmaXJtYXRpb25zIH0gZnJvbSAnLi90cmFkaW5nL2FmZmlybWF0aW9ucyc7XG5cbmNvbnN0IGNvID0gQmx1ZWJpcmQuY29yb3V0aW5lO1xuXG5leHBvcnQgY2xhc3MgRW50ZXJwcmlzZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgYml0Z286IEJpdEdvO1xuICBwcml2YXRlIHJlYWRvbmx5IGJhc2VDb2luOiBCYXNlQ29pbjtcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGJpdGdvOiBCaXRHbywgYmFzZUNvaW46IEJhc2VDb2luLCBlbnRlcnByaXNlRGF0YTogeyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfSkge1xuICAgIHRoaXMuYml0Z28gPSBiaXRnbztcbiAgICB0aGlzLmJhc2VDb2luID0gYmFzZUNvaW47XG4gICAgaWYgKCFfLmlzT2JqZWN0KGVudGVycHJpc2VEYXRhKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdlbnRlcnByaXNlRGF0YSBoYXMgdG8gYmUgYW4gb2JqZWN0Jyk7XG4gICAgfVxuICAgIGlmICghXy5pc1N0cmluZyhlbnRlcnByaXNlRGF0YS5pZCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZW50ZXJwcmlzZSBpZCBoYXMgdG8gYmUgYSBzdHJpbmcnKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzU3RyaW5nKGVudGVycHJpc2VEYXRhLm5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VudGVycHJpc2UgbmFtZSBoYXMgdG8gYmUgYSBzdHJpbmcnKTtcbiAgICB9XG4gICAgdGhpcy5pZCA9IGVudGVycHJpc2VEYXRhLmlkO1xuICAgIHRoaXMubmFtZSA9IGVudGVycHJpc2VEYXRhLm5hbWU7XG4gIH1cblxuICAvKipcbiAgICogRW50ZXJwcmlzZSBVUkwgZm9yIHYxIG1ldGhvZHMsIHN1Y2ggYXMgZ2V0dGluZyB1c2Vyc1xuICAgKiBAcGFyYW0gcXVlcnlcbiAgICovXG4gIHVybChxdWVyeTogc3RyaW5nID0gJycpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmJpdGdvLnVybChgL2VudGVycHJpc2UvJHt0aGlzLmlkfSR7cXVlcnl9YCk7XG4gIH1cblxuICAvKipcbiAgICogRW50ZXJwcmlzZSBVUkwgZm9yIHYyIG1ldGhvZHMsIHN1Y2ggYXMgZ2V0dGluZyBmZWUgYWRkcmVzcyBiYWxhbmNlc1xuICAgKiBAcGFyYW0gcXVlcnlcbiAgICovXG4gIGNvaW5VcmwocXVlcnk6IHN0cmluZyA9ICcnKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5iYXNlQ29pbi51cmwoYC9lbnRlcnByaXNlLyR7dGhpcy5pZH0ke3F1ZXJ5fWApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgd2FsbGV0cyBhc3NvY2lhdGVkIHdpdGggdGhpcyBFbnRlcnByaXNlXG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqL1xuICBjb2luV2FsbGV0cyhwYXJhbXM6IHt9ID0ge30sIGNhbGxiYWNrPzogTm9kZUNhbGxiYWNrPFdhbGxldFtdPik6IEJsdWViaXJkPFdhbGxldFtdPiB7XG4gICAgcmV0dXJuIGNvPFdhbGxldFtdPihmdW5jdGlvbiogY29Db2luV2FsbGV0cygpIHtcbiAgICAgIGNvbnN0IHdhbGxldERhdGEgPSB5aWVsZCB0aGlzLmJpdGdvLmdldCh0aGlzLmJhc2VDb2luLnVybCgnL3dhbGxldC9lbnRlcnByaXNlLycgKyB0aGlzLmlkKSkucmVzdWx0KCk7XG4gICAgICB3YWxsZXREYXRhLndhbGxldHMgPSB3YWxsZXREYXRhLndhbGxldHMubWFwKHcgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFdhbGxldCh0aGlzLmJpdGdvLCB0aGlzLmJhc2VDb2luLCB3KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHdhbGxldERhdGE7XG4gICAgfSlcbiAgICAgIC5jYWxsKHRoaXMpXG4gICAgICAuYXNDYWxsYmFjayhjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB1c2VycyBhc3NvY2lhdGVkIHdpdGggdGhpcyBFbnRlcnByaXNlXG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqL1xuICB1c2VycyhwYXJhbXM6IHt9ID0ge30sIGNhbGxiYWNrPzogTm9kZUNhbGxiYWNrPGFueT4pOiBCbHVlYmlyZDxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5iaXRnb1xuICAgICAgLmdldCh0aGlzLnVybCgnL3VzZXInKSlcbiAgICAgIC5yZXN1bHQoKVxuICAgICAgLmFzQ2FsbGJhY2soY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgZmVlIGFkZHJlc3MgYmFsYW5jZSBmb3IgdGhpcyBFbnRlcnByaXNlXG4gICAqIEBwYXJhbSBwYXJhbXNcbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqL1xuICBnZXRGZWVBZGRyZXNzQmFsYW5jZShwYXJhbXM6IHt9ID0ge30sIGNhbGxiYWNrPzogTm9kZUNhbGxiYWNrPGFueT4pOiBCbHVlYmlyZDxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5iaXRnb1xuICAgICAgLmdldCh0aGlzLmNvaW5VcmwoJy9mZWVBZGRyZXNzQmFsYW5jZScpKVxuICAgICAgLnJlc3VsdCgpXG4gICAgICAuYXNDYWxsYmFjayhjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgdXNlciB0byB0aGlzIEVudGVycHJpc2VcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIGFkZFVzZXIocGFyYW1zOiBhbnkgPSB7fSwgY2FsbGJhY2s/OiBOb2RlQ2FsbGJhY2s8YW55Pik6IEJsdWViaXJkPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmJpdGdvXG4gICAgICAucG9zdCh0aGlzLnVybCgnL3VzZXInKSlcbiAgICAgIC5zZW5kKHBhcmFtcylcbiAgICAgIC5yZXN1bHQoKVxuICAgICAgLmFzQ2FsbGJhY2soY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIHVzZXIgZnJvbSB0aGlzIEVudGVycHJpc2VcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIHJlbW92ZVVzZXIocGFyYW1zOiBhbnkgPSB7fSwgY2FsbGJhY2s/OiBOb2RlQ2FsbGJhY2s8YW55Pik6IEJsdWViaXJkPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmJpdGdvXG4gICAgICAuZGVsKHRoaXMudXJsKCcvdXNlcicpKVxuICAgICAgLnNlbmQocGFyYW1zKVxuICAgICAgLnJlc3VsdCgpXG4gICAgICAuYXNDYWxsYmFjayhjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBmaXJzdCBwZW5kaW5nIHRyYW5zYWN0aW9uIGZvciB0aGlzIEVudGVycHJpc2VcbiAgICogQHBhcmFtIHBhcmFtc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIGdldEZpcnN0UGVuZGluZ1RyYW5zYWN0aW9uKHBhcmFtczoge30gPSB7fSwgY2FsbGJhY2s/OiBOb2RlQ2FsbGJhY2s8YW55Pik6IEJsdWViaXJkPGFueT4ge1xuICAgIHJldHVybiBnZXRGaXJzdFBlbmRpbmdUcmFuc2FjdGlvbih7IGVudGVycHJpc2VJZDogdGhpcy5pZCB9LCB0aGlzLmJhc2VDb2luLCB0aGlzLmJpdGdvKS5hc0NhbGxiYWNrKGNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYW5hZ2Ugc2V0dGxlbWVudHMgZm9yIGFuIGVudGVycHJpc2VcbiAgICovXG4gIHNldHRsZW1lbnRzKCk6IFNldHRsZW1lbnRzIHtcbiAgICByZXR1cm4gbmV3IFNldHRsZW1lbnRzKHRoaXMuYml0Z28sIHRoaXMuaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hbmFnZSBhZmZpcm1hdGlvbnMgZm9yIGFuIGVudGVycHJpc2VcbiAgICovXG4gIGFmZmlybWF0aW9ucygpOiBBZmZpcm1hdGlvbnMge1xuICAgIHJldHVybiBuZXcgQWZmaXJtYXRpb25zKHRoaXMuYml0Z28sIHRoaXMuaWQpO1xuICB9XG59XG4iXX0=