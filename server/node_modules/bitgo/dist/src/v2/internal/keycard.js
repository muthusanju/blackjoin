"use strict";
/**
 * @hidden
 */
Object.defineProperty(exports, "__esModule", { value: true });
/**
 */
var lodash_1 = require("lodash");
/**
 * Return the list of questions that will appear on the second page of the keycard
 * @param coin name of the coin
 */
var generateQuestions = function (coin) {
    return [
        {
            q: 'What is the KeyCard?',
            a: [
                "The KeyCard contains important information which can be used to recover the " + coin + " ",
                'from your wallet in several situations. Each BitGo wallet' +
                    ' has its own, unique KeyCard. ',
                'If you have created multiple wallets, you should retain the KeyCard for each of them.'
            ]
        },
        {
            q: 'What should I do with it?',
            a: [
                'You should print the KeyCard and/or save the PDF to an offline storage device. The print-out ',
                'or USB stick should be kept in a safe place, such as a bank vault or home safe. It\'s a good idea ',
                'to keep a second copy in a different location.',
                '',
                'Important: If you haven\'t provided an external backup key, then the original PDF should be ',
                'deleted from any machine where the wallet will be regularly accessed to prevent malware from ',
                'capturing both the KeyCard and your wallet passcode.'
            ]
        },
        {
            q: 'What should I do if I lose it?',
            a: [
                "If you have lost or damaged all copies of your KeyCard, your " + coin + " is still safe, but this ",
                'wallet should be considered at risk for loss. As soon as is convenient, you should use BitGo ',
                'to empty the wallet into a new wallet',
                ', and discontinue use of the old wallet.'
            ]
        },
        {
            q: 'What if someone sees my KeyCard?',
            a: [
                'Don\'t panic! All sensitive information on the KeyCard is encrypted with your passcode, or with a',
                'key which only BitGo has. But, in general, you should make best efforts to keep your ',
                'KeyCard private. If your KeyCard does get exposed or copied in a way that makes you ',
                'uncomfortable, the best course of action is to empty the corresponding wallet into another ',
                'wallet and discontinue use of the old wallet.'
            ]
        },
        {
            q: 'What if I forget or lose my wallet password?',
            a: [
                'BitGo can use the information in QR Code D to help you recover access to your wallet. ',
                'Without the KeyCard, BitGo is not able to recover funds from a wallet with a lost password.'
            ]
        },
        {
            q: 'What if BitGo becomes inaccessible for an extended period?',
            a: [
                'Your KeyCard and wallet passcode can be used together with BitGo’s published open ',
                "source tools at https://github.com/bitgo to recover your " + coin + ". Note: You should never enter ",
                'information from your KeyCard into tools other than the tools BitGo has published, or your ',
                'funds may be at risk for theft.'
            ]
        },
        {
            q: 'Should I write my wallet password on my KeyCard?',
            a: [
                'No! BitGo’s multi-signature approach to security depends on there not being a single point ',
                'of attack. But if your wallet password is on your KeyCard, then anyone who gains access to ',
                "your KeyCard will be able to steal your " + coin + ". We recommend keeping your wallet password ",
                'safe in a secure password manager such as LastPass, 1Password or KeePass.'
            ]
        }
    ];
};
/**
 * Collect all data which will go onto the keycard
 * @param options
 */
function getKeyData(options) {
    var encrypt = options.encrypt, userKeychain = options.userKeychain, bitgoKeychain = options.bitgoKeychain, backupKeychain = options.backupKeychain, coinShortName = options.coinShortName, passphrase = options.passphrase, passcodeEncryptionCode = options.passcodeEncryptionCode, walletKeyID = options.walletKeyID, backupKeyID = options.backupKeyID;
    // When using just 'generateWallet', we get back an unencrypted prv for the backup keychain
    // If the user passes in their passphrase, we can encrypt it
    if (backupKeychain.prv && passphrase) {
        backupKeychain.encryptedPrv = encrypt({
            input: backupKeychain.prv,
            password: passphrase
        });
    }
    // If we have the passcode encryption code, create a box D with the encryptedWalletPasscode
    var encryptedWalletPasscode;
    if (passphrase && passcodeEncryptionCode) {
        encryptedWalletPasscode = encrypt({
            input: passphrase,
            password: passcodeEncryptionCode,
        });
    }
    // PDF QR Code data
    var qrData = {
        user: {
            title: 'A: User Key',
            desc: 'This is your private key, encrypted with your passcode.',
            data: userKeychain.encryptedPrv,
        },
        backup: {
            title: 'B: Backup Key',
            desc: 'This is your backup private key, encrypted with your passcode.',
            data: backupKeychain.encryptedPrv,
        },
        bitgo: {
            title: 'C: BitGo Public Key',
            desc: 'This is the public part of the key that BitGo will use to ' +
                'co-sign transactions\r\nwith you on your wallet.',
            data: bitgoKeychain.pub,
        },
        passcode: {
            title: 'D: Encrypted Wallet Password',
            desc: 'This is the wallet  password, encrypted client-side ' +
                'with a key held by\r\nBitGo.',
            data: encryptedWalletPasscode,
        },
    };
    if (walletKeyID) {
        qrData.user.keyID = walletKeyID;
    }
    if (backupKeyID) {
        qrData.backup.keyID = backupKeyID;
    }
    if (lodash_1.isUndefined(userKeychain.encryptedPrv)) {
        // User provided their own key - this is a cold wallet
        qrData.user.title = 'A: Provided User Key';
        qrData.user.desc = 'This is the public key you provided for your wallet.';
        qrData.user.data = userKeychain.pub;
        // The user provided their own public key, we can remove box D
        delete qrData.passcode;
    }
    else if (lodash_1.isUndefined(encryptedWalletPasscode)) {
        delete qrData.passcode;
    }
    if (!lodash_1.isUndefined(backupKeychain.provider)) {
        var backupKeyProviderName = backupKeychain.provider;
        // Backup key held with KRS
        qrData.backup = {
            title: 'B: Backup Key',
            desc: "This is the public key held at " + backupKeyProviderName +
                (", an " + coinShortName + " recovery service. If you lose\r\nyour key, " + backupKeyProviderName) +
                ' will be able to sign transactions to recover funds.',
            data: backupKeychain.pub,
        };
    }
    else if (lodash_1.isUndefined(backupKeychain.encryptedPrv)) {
        // User supplied the xpub
        qrData.backup = {
            title: 'B: Backup Key',
            desc: 'This is the public portion of your backup key, which you provided.',
            data: backupKeychain.pub,
        };
    }
    return qrData;
}
/**
 * Draw a keycard into a new pdf document object
 * @param options
 */
function drawKeycard(options) {
    var jsPDF = options.jsPDF, QRCode = options.QRCode, coinShortName = options.coinShortName, activationCode = options.activationCode, walletLabel = options.walletLabel, coinName = options.coinName;
    var margin = 30;
    var font = {
        header: 24,
        subheader: 15,
        body: 12
    };
    var color = {
        black: '#000000',
        darkgray: '#4c4c4c',
        gray: '#9b9b9b',
        red: '#e21e1e'
    };
    // document details
    var width = 8.5 * 72;
    var y = 0;
    // Helpers for data formatting / positioning on the paper
    var left = function (x) { return margin + x; };
    var moveDown = function (yDelta) { y += yDelta; };
    var doc = new jsPDF('portrait', 'pt', 'letter');
    doc.setFont('helvetica');
    // PDF Header Area - includes the logo and company name
    // This is data for the BitGo logo in the top left of the PDF
    moveDown(30);
    // We don't currently add an image, since that path is dependent on BitGo frontend
    // doc.addImage(coinUtility.getSelectedCoinObj().keyCardImage, left(0), y + 10);
    // Activation Code
    moveDown(8);
    doc.setFontSize(font.body).setTextColor(color.gray);
    doc.text('Activation Code', left(460), y);
    doc.setFontSize(font.header).setTextColor(color.black);
    moveDown(25);
    doc.text('Your BitGo KeyCard', left(150), y);
    doc.setFontSize(font.header).setTextColor(color.gray);
    doc.text(activationCode.toString(), left(460), y);
    // Subheader
    // titles
    moveDown(margin);
    doc.setFontSize(font.body).setTextColor(color.gray);
    doc.text("Created on " + new Date().toDateString() + " by " + window.location.hostname + " for wallet named " + walletLabel, left(0), y);
    // copy
    moveDown(25);
    doc.setFontSize(font.subheader).setTextColor(color.black);
    doc.text(walletLabel, left(0), y);
    // Red Bar
    moveDown(20);
    doc.setFillColor(255, 230, 230);
    doc.rect(left(0), y, width - 2 * margin, 32, 'F');
    // warning message
    moveDown(20);
    doc.setFontSize(font.body).setTextColor(color.red);
    doc.text('Print this document, or keep it securely offline. See second page for FAQ.', left(75), y);
    var encrypt = options.encrypt, passphrase = options.passphrase, passcodeEncryptionCode = options.passcodeEncryptionCode, walletKeyID = options.walletKeyID, backupKeyID = options.backupKeyID, userKeychain = options.userKeychain, bitgoKeychain = options.bitgoKeychain, backupKeychain = options.backupKeychain;
    // Get the data for the first page (qr codes)
    var keyData = getKeyData({
        encrypt: encrypt,
        coinShortName: coinShortName,
        passphrase: passphrase,
        passcodeEncryptionCode: passcodeEncryptionCode,
        walletKeyID: walletKeyID,
        backupKeyID: backupKeyID,
        userKeychain: userKeychain,
        bitgoKeychain: bitgoKeychain,
        backupKeychain: backupKeychain,
    });
    // Generate the first page's data for the backup PDF
    moveDown(35);
    var qrSize = 130;
    // Draw each Box with QR code and description
    Object.keys(keyData).forEach(function (keyType) {
        var key = keyData[keyType];
        var topY = y;
        // Don't indent if we're not producing QR codes
        var textLeft = !!QRCode ? left(qrSize + 15) : left(15);
        // Draw a QR code if library is available
        if (QRCode) {
            var dataURL = new QRCode({ value: key.data, size: qrSize }).toDataURL('image/jpeg');
            doc.addImage(dataURL, left(0), y, qrSize, qrSize);
        }
        doc.setFontSize(font.subheader).setTextColor(color.black);
        moveDown(10);
        doc.text(key.title, textLeft, y);
        moveDown(15);
        doc.setFontSize(font.body).setTextColor(color.darkgray);
        doc.text(key.desc, textLeft, y);
        moveDown(30);
        doc.setFontSize(font.body - 2);
        doc.text('Data:', textLeft, y);
        moveDown(15);
        var innerWidth = 72 * 8.5 - textLeft - 30;
        doc.setFont('courier').setFontSize(9).setTextColor(color.black);
        var lines = doc.splitTextToSize(key.data, innerWidth);
        doc.text(lines, textLeft, y);
        // Add key ID (derivation string) if it exists
        if (key.keyID) {
            var text = 'Key Id: ' + key.keyID;
            // Gray bar
            moveDown(45);
            doc.setFillColor(247, 249, 249); // Gray background
            doc.setDrawColor(0, 0, 0); // Border
            doc.rect(textLeft, y, width, 15, 'FD');
            doc.text(text, textLeft + 5, y + 10);
        }
        doc.setFont('helvetica');
        // Move down the size of the QR code minus accumulated height on the right side, plus buffer
        moveDown(qrSize - (y - topY) + 15);
    });
    // Add a new page (Q + A page)
    doc.addPage();
    // 2nd page title
    y = 0;
    moveDown(55);
    doc.setFontSize(font.header).setTextColor(color.black);
    doc.text('BitGo KeyCard FAQ', left(0), y);
    var questions = generateQuestions(coinName);
    // Draw the Q + A data on the second page
    moveDown(30);
    questions.forEach(function (q) {
        doc.setFontSize(font.subheader).setTextColor(color.black);
        doc.text(q.q, left(0), y);
        moveDown(20);
        doc.setFontSize(font.body).setTextColor(color.darkgray);
        q.a.forEach(function (line) {
            doc.text(line, left(0), y);
            moveDown(font.body + 3);
        });
        moveDown(22);
    });
    return doc;
}
exports.drawKeycard = drawKeycard;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5Y2FyZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92Mi9pbnRlcm5hbC9rZXljYXJkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSDtHQUNHO0FBQ0gsaUNBQXFDO0FBRXJDOzs7R0FHRztBQUNILElBQU0saUJBQWlCLEdBQUcsVUFBQyxJQUFZO0lBQ3JDLE9BQU87UUFDTDtZQUNFLENBQUMsRUFBRSxzQkFBc0I7WUFDekIsQ0FBQyxFQUNDO2dCQUNFLGlGQUErRSxJQUFJLE1BQUc7Z0JBQ3RGLDJEQUEyRDtvQkFDM0QsZ0NBQWdDO2dCQUNoQyx1RkFBdUY7YUFDeEY7U0FDSjtRQUNEO1lBQ0UsQ0FBQyxFQUFFLDJCQUEyQjtZQUM5QixDQUFDLEVBQ0M7Z0JBQ0UsK0ZBQStGO2dCQUMvRixvR0FBb0c7Z0JBQ3BHLGdEQUFnRDtnQkFDaEQsRUFBRTtnQkFDRiw4RkFBOEY7Z0JBQzlGLCtGQUErRjtnQkFDL0Ysc0RBQXNEO2FBQ3ZEO1NBQ0o7UUFDRDtZQUNFLENBQUMsRUFBRSxnQ0FBZ0M7WUFDbkMsQ0FBQyxFQUNDO2dCQUNFLGtFQUFnRSxJQUFJLDhCQUEyQjtnQkFDL0YsK0ZBQStGO2dCQUMvRix1Q0FBdUM7Z0JBQ3ZDLDBDQUEwQzthQUMzQztTQUNKO1FBQ0Q7WUFDRSxDQUFDLEVBQUUsa0NBQWtDO1lBQ3JDLENBQUMsRUFDQztnQkFDRSxtR0FBbUc7Z0JBQ25HLHVGQUF1RjtnQkFDdkYsc0ZBQXNGO2dCQUN0Riw2RkFBNkY7Z0JBQzdGLCtDQUErQzthQUNoRDtTQUNKO1FBQ0Q7WUFDRSxDQUFDLEVBQUUsOENBQThDO1lBQ2pELENBQUMsRUFDQztnQkFDRSx3RkFBd0Y7Z0JBQ3hGLDZGQUE2RjthQUM5RjtTQUNKO1FBQ0Q7WUFDRSxDQUFDLEVBQUUsNERBQTREO1lBQy9ELENBQUMsRUFDQztnQkFDRSxvRkFBb0Y7Z0JBQ3BGLDhEQUE0RCxJQUFJLG9DQUFpQztnQkFDakcsNkZB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R0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMxQixRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDYixHQUFHLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVMsSUFBSTtZQUN2QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0IsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7UUFDSCxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDZixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQTdLRCxrQ0E2S0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBoaWRkZW5cbiAqL1xuXG4vKipcbiAqL1xuaW1wb3J0IHsgaXNVbmRlZmluZWQgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgS2V5Y2hhaW4gfSBmcm9tICcuLi9rZXljaGFpbnMnO1xuLyoqXG4gKiBSZXR1cm4gdGhlIGxpc3Qgb2YgcXVlc3Rpb25zIHRoYXQgd2lsbCBhcHBlYXIgb24gdGhlIHNlY29uZCBwYWdlIG9mIHRoZSBrZXljYXJkXG4gKiBAcGFyYW0gY29pbiBuYW1lIG9mIHRoZSBjb2luXG4gKi9cbmNvbnN0IGdlbmVyYXRlUXVlc3Rpb25zID0gKGNvaW46IHN0cmluZykgPT4ge1xuICByZXR1cm4gW1xuICAgIHtcbiAgICAgIHE6ICdXaGF0IGlzIHRoZSBLZXlDYXJkPycsXG4gICAgICBhOlxuICAgICAgICBbXG4gICAgICAgICAgYFRoZSBLZXlDYXJkIGNvbnRhaW5zIGltcG9ydGFudCBpbmZvcm1hdGlvbiB3aGljaCBjYW4gYmUgdXNlZCB0byByZWNvdmVyIHRoZSAke2NvaW59IGAsXG4gICAgICAgICAgJ2Zyb20geW91ciB3YWxsZXQgaW4gc2V2ZXJhbCBzaXR1YXRpb25zLiBFYWNoIEJpdEdvIHdhbGxldCcgK1xuICAgICAgICAgICcgaGFzIGl0cyBvd24sIHVuaXF1ZSBLZXlDYXJkLiAnLFxuICAgICAgICAgICdJZiB5b3UgaGF2ZSBjcmVhdGVkIG11bHRpcGxlIHdhbGxldHMsIHlvdSBzaG91bGQgcmV0YWluIHRoZSBLZXlDYXJkIGZvciBlYWNoIG9mIHRoZW0uJ1xuICAgICAgICBdXG4gICAgfSxcbiAgICB7XG4gICAgICBxOiAnV2hhdCBzaG91bGQgSSBkbyB3aXRoIGl0PycsXG4gICAgICBhOlxuICAgICAgICBbXG4gICAgICAgICAgJ1lvdSBzaG91bGQgcHJpbnQgdGhlIEtleUNhcmQgYW5kL29yIHNhdmUgdGhlIFBERiB0byBhbiBvZmZsaW5lIHN0b3JhZ2UgZGV2aWNlLiBUaGUgcHJpbnQtb3V0ICcsXG4gICAgICAgICAgJ29yIFVTQiBzdGljayBzaG91bGQgYmUga2VwdCBpbiBhIHNhZmUgcGxhY2UsIHN1Y2ggYXMgYSBiYW5rIHZhdWx0IG9yIGhvbWUgc2FmZS4gSXRcXCdzIGEgZ29vZCBpZGVhICcsXG4gICAgICAgICAgJ3RvIGtlZXAgYSBzZWNvbmQgY29weSBpbiBhIGRpZmZlcmVudCBsb2NhdGlvbi4nLFxuICAgICAgICAgICcnLFxuICAgICAgICAgICdJbXBvcnRhbnQ6IElmIHlvdSBoYXZlblxcJ3QgcHJvdmlkZWQgYW4gZXh0ZXJuYWwgYmFja3VwIGtleSwgdGhlbiB0aGUgb3JpZ2luYWwgUERGIHNob3VsZCBiZSAnLFxuICAgICAgICAgICdkZWxldGVkIGZyb20gYW55IG1hY2hpbmUgd2hlcmUgdGhlIHdhbGxldCB3aWxsIGJlIHJlZ3VsYXJseSBhY2Nlc3NlZCB0byBwcmV2ZW50IG1hbHdhcmUgZnJvbSAnLFxuICAgICAgICAgICdjYXB0dXJpbmcgYm90aCB0aGUgS2V5Q2FyZCBhbmQgeW91ciB3YWxsZXQgcGFzc2NvZGUuJ1xuICAgICAgICBdXG4gICAgfSxcbiAgICB7XG4gICAgICBxOiAnV2hhdCBzaG91bGQgSSBkbyBpZiBJIGxvc2UgaXQ/JyxcbiAgICAgIGE6XG4gICAgICAgIFtcbiAgICAgICAgICBgSWYgeW91IGhhdmUgbG9zdCBvciBkYW1hZ2VkIGFsbCBjb3BpZXMgb2YgeW91ciBLZXlDYXJkLCB5b3VyICR7Y29pbn0gaXMgc3RpbGwgc2FmZSwgYnV0IHRoaXMgYCxcbiAgICAgICAgICAnd2FsbGV0IHNob3VsZCBiZSBjb25zaWRlcmVkIGF0IHJpc2sgZm9yIGxvc3MuIEFzIHNvb24gYXMgaXMgY29udmVuaWVudCwgeW91IHNob3VsZCB1c2UgQml0R28gJyxcbiAgICAgICAgICAndG8gZW1wdHkgdGhlIHdhbGxldCBpbnRvIGEgbmV3IHdhbGxldCcsXG4gICAgICAgICAgJywgYW5kIGRpc2NvbnRpbnVlIHVzZSBvZiB0aGUgb2xkIHdhbGxldC4nXG4gICAgICAgIF1cbiAgICB9LFxuICAgIHtcbiAgICAgIHE6ICdXaGF0IGlmIHNvbWVvbmUgc2VlcyBteSBLZXlDYXJkPycsXG4gICAgICBhOlxuICAgICAgICBbXG4gICAgICAgICAgJ0RvblxcJ3QgcGFuaWMhIEFsbCBzZW5zaXRpdmUgaW5mb3JtYXRpb24gb24gdGhlIEtleUNhcmQgaXMgZW5jcnlwdGVkIHdpdGggeW91ciBwYXNzY29kZSwgb3Igd2l0aCBhJyxcbiAgICAgICAgICAna2V5IHdoaWNoIG9ubHkgQml0R28gaGFzLiBCdXQsIGluIGdlbmVyYWwsIHlvdSBzaG91bGQgbWFrZSBiZXN0IGVmZm9ydHMgdG8ga2VlcCB5b3VyICcsXG4gICAgICAgICAgJ0tleUNhcmQgcHJpdmF0ZS4gSWYgeW91ciBLZXlDYXJkIGRvZXMgZ2V0IGV4cG9zZWQgb3IgY29waWVkIGluIGEgd2F5IHRoYXQgbWFrZXMgeW91ICcsXG4gICAgICAgICAgJ3VuY29tZm9ydGFibGUsIHRoZSBiZXN0IGNvdXJzZSBvZiBhY3Rpb24gaXMgdG8gZW1wdHkgdGhlIGNvcnJlc3BvbmRpbmcgd2FsbGV0IGludG8gYW5vdGhlciAnLFxuICAgICAgICAgICd3YWxsZXQgYW5kIGRpc2NvbnRpbnVlIHVzZSBvZiB0aGUgb2xkIHdhbGxldC4nXG4gICAgICAgIF1cbiAgICB9LFxuICAgIHtcbiAgICAgIHE6ICdXaGF0IGlmIEkgZm9yZ2V0IG9yIGxvc2UgbXkgd2FsbGV0IHBhc3N3b3JkPycsXG4gICAgICBhOlxuICAgICAgICBbXG4gICAgICAgICAgJ0JpdEdvIGNhbiB1c2UgdGhlIGluZm9ybWF0aW9uIGluIFFSIENvZGUgRCB0byBoZWxwIHlvdSByZWNvdmVyIGFjY2VzcyB0byB5b3VyIHdhbGxldC4gJyxcbiAgICAgICAgICAnV2l0aG91dCB0aGUgS2V5Q2FyZCwgQml0R28gaXMgbm90IGFibGUgdG8gcmVjb3ZlciBmdW5kcyBmcm9tIGEgd2FsbGV0IHdpdGggYSBsb3N0IHBhc3N3b3JkLidcbiAgICAgICAgXVxuICAgIH0sXG4gICAge1xuICAgICAgcTogJ1doYXQgaWYgQml0R28gYmVjb21lcyBpbmFjY2Vzc2libGUgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZD8nLFxuICAgICAgYTpcbiAgICAgICAgW1xuICAgICAgICAgICdZb3VyIEtleUNhcmQgYW5kIHdhbGxldCBwYXNzY29kZSBjYW4gYmUgdXNlZCB0b2dldGhlciB3aXRoIEJpdEdv4oCZcyBwdWJsaXNoZWQgb3BlbiAnLFxuICAgICAgICAgIGBzb3VyY2UgdG9vbHMgYXQgaHR0cHM6Ly9naXRodWIuY29tL2JpdGdvIHRvIHJlY292ZXIgeW91ciAke2NvaW59LiBOb3RlOiBZb3Ugc2hvdWxkIG5ldmVyIGVudGVyIGAsXG4gICAgICAgICAgJ2luZm9ybWF0aW9uIGZyb20geW91ciBLZXlDYXJkIGludG8gdG9vbHMgb3RoZXIgdGhhbiB0aGUgdG9vbHMgQml0R28gaGFzIHB1Ymxpc2hlZCwgb3IgeW91ciAnLFxuICAgICAgICAgICdmdW5kcyBtYXkgYmUgYXQgcmlzayBmb3IgdGhlZnQuJ1xuICAgICAgICBdXG4gICAgfSxcbiAgICB7XG4gICAgICBxOiAnU2hvdWxkIEkgd3JpdGUgbXkgd2FsbGV0IHBhc3N3b3JkIG9uIG15IEtleUNhcmQ/JyxcbiAgICAgIGE6XG4gICAgICAgIFtcbiAgICAgICAgICAnTm8hIEJpdEdv4oCZcyBtdWx0aS1zaWduYXR1cmUgYXBwcm9hY2ggdG8gc2VjdXJpdHkgZGVwZW5kcyBvbiB0aGVyZSBub3QgYmVpbmcgYSBzaW5nbGUgcG9pbnQgJyxcbiAgICAgICAgICAnb2YgYXR0YWNrLiBCdXQgaWYgeW91ciB3YWxsZXQgcGFzc3dvcmQgaXMgb24geW91ciBLZXlDYXJkLCB0aGVuIGFueW9uZSB3aG8gZ2FpbnMgYWNjZXNzIHRvICcsXG4gICAgICAgICAgYHlvdXIgS2V5Q2FyZCB3aWxsIGJlIGFibGUgdG8gc3RlYWwgeW91ciAke2NvaW59LiBXZSByZWNvbW1lbmQga2VlcGluZyB5b3VyIHdhbGxldCBwYXNzd29yZCBgLFxuICAgICAgICAgICdzYWZlIGluIGEgc2VjdXJlIHBhc3N3b3JkIG1hbmFnZXIgc3VjaCBhcyBMYXN0UGFzcywgMVBhc3N3b3JkIG9yIEtlZVBhc3MuJ1xuICAgICAgICBdXG4gICAgfVxuICBdO1xufTtcblxuaW50ZXJmYWNlIEdldEtleURhdGFPcHRpb25zIHtcbiAgZW5jcnlwdDogKHBhcmFtczoge2lucHV0OiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmd9KSA9PiBzdHJpbmcsXG4gIHVzZXJLZXljaGFpbjogS2V5Y2hhaW47XG4gIGJpdGdvS2V5Y2hhaW46IEtleWNoYWluO1xuICBiYWNrdXBLZXljaGFpbjogS2V5Y2hhaW47XG4gIGNvaW5TaG9ydE5hbWU6IHN0cmluZztcbiAgcGFzc3BocmFzZT86IHN0cmluZztcbiAgcGFzc2NvZGVFbmNyeXB0aW9uQ29kZT86IHN0cmluZztcbiAgd2FsbGV0S2V5SUQ/OiBzdHJpbmc7XG4gIGJhY2t1cEtleUlEPzogc3RyaW5nXG59XG5cbi8qKlxuICogQ29sbGVjdCBhbGwgZGF0YSB3aGljaCB3aWxsIGdvIG9udG8gdGhlIGtleWNhcmRcbiAqIEBwYXJhbSBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGdldEtleURhdGEob3B0aW9uczogR2V0S2V5RGF0YU9wdGlvbnMpOiBhbnkge1xuICBjb25zdCB7XG4gICAgZW5jcnlwdCxcbiAgICB1c2VyS2V5Y2hhaW4sXG4gICAgYml0Z29LZXljaGFpbixcbiAgICBiYWNrdXBLZXljaGFpbixcbiAgICBjb2luU2hvcnROYW1lLFxuICAgIHBhc3NwaHJhc2UsXG4gICAgcGFzc2NvZGVFbmNyeXB0aW9uQ29kZSxcbiAgICB3YWxsZXRLZXlJRCxcbiAgICBiYWNrdXBLZXlJRCxcbiAgfSA9IG9wdGlvbnM7XG5cbiAgLy8gV2hlbiB1c2luZyBqdXN0ICdnZW5lcmF0ZVdhbGxldCcsIHdlIGdldCBiYWNrIGFuIHVuZW5jcnlwdGVkIHBydiBmb3IgdGhlIGJhY2t1cCBrZXljaGFpblxuICAvLyBJZiB0aGUgdXNlciBwYXNzZXMgaW4gdGhlaXIgcGFzc3BocmFzZSwgd2UgY2FuIGVuY3J5cHQgaXRcbiAgaWYgKGJhY2t1cEtleWNoYWluLnBydiAmJiBwYXNzcGhyYXNlKSB7XG4gICAgYmFja3VwS2V5Y2hhaW4uZW5jcnlwdGVkUHJ2ID0gZW5jcnlwdCh7XG4gICAgICBpbnB1dDogYmFja3VwS2V5Y2hhaW4ucHJ2LFxuICAgICAgcGFzc3dvcmQ6IHBhc3NwaHJhc2VcbiAgICB9KTtcbiAgfVxuXG4gIC8vIElmIHdlIGhhdmUgdGhlIHBhc3Njb2RlIGVuY3J5cHRpb24gY29kZSwgY3JlYXRlIGEgYm94IEQgd2l0aCB0aGUgZW5jcnlwdGVkV2FsbGV0UGFzc2NvZGVcbiAgbGV0IGVuY3J5cHRlZFdhbGxldFBhc3Njb2RlO1xuICBpZiAocGFzc3BocmFzZSAmJiBwYXNzY29kZUVuY3J5cHRpb25Db2RlKSB7XG4gICAgZW5jcnlwdGVkV2FsbGV0UGFzc2NvZGUgPSBlbmNyeXB0KHtcbiAgICAgIGlucHV0OiBwYXNzcGhyYXNlLFxuICAgICAgcGFzc3dvcmQ6IHBhc3Njb2RlRW5jcnlwdGlvbkNvZGUsXG4gICAgfSk7XG4gIH1cblxuICAvLyBQREYgUVIgQ29kZSBkYXRhXG4gIGNvbnN0IHFyRGF0YTogYW55ID0ge1xuICAgIHVzZXI6IHtcbiAgICAgIHRpdGxlOiAnQTogVXNlciBLZXknLFxuICAgICAgZGVzYzogJ1RoaXMgaXMgeW91ciBwcml2YXRlIGtleSwgZW5jcnlwdGVkIHdpdGggeW91ciBwYXNzY29kZS4nLFxuICAgICAgZGF0YTogdXNlcktleWNoYWluLmVuY3J5cHRlZFBydixcbiAgICB9LFxuICAgIGJhY2t1cDoge1xuICAgICAgdGl0bGU6ICdCOiBCYWNrdXAgS2V5JyxcbiAgICAgIGRlc2M6ICdUaGlzIGlzIHlvdXIgYmFja3VwIHByaXZhdGUga2V5LCBlbmNyeXB0ZWQgd2l0aCB5b3VyIHBhc3Njb2RlLicsXG4gICAgICBkYXRhOiBiYWNrdXBLZXljaGFpbi5lbmNyeXB0ZWRQcnYsXG4gICAgfSxcbiAgICBiaXRnbzoge1xuICAgICAgdGl0bGU6ICdDOiBCaXRHbyBQdWJsaWMgS2V5JyxcbiAgICAgIGRlc2M6ICdUaGlzIGlzIHRoZSBwdWJsaWMgcGFydCBvZiB0aGUga2V5IHRoYXQgQml0R28gd2lsbCB1c2UgdG8gJyArXG4gICAgICAgICdjby1zaWduIHRyYW5zYWN0aW9uc1xcclxcbndpdGggeW91IG9uIHlvdXIgd2FsbGV0LicsXG4gICAgICBkYXRhOiBiaXRnb0tleWNoYWluLnB1YixcbiAgICB9LFxuICAgIHBhc3Njb2RlOiB7XG4gICAgICB0aXRsZTogJ0Q6IEVuY3J5cHRlZCBXYWxsZXQgUGFzc3dvcmQnLFxuICAgICAgZGVzYzogJ1RoaXMgaXMgdGhlIHdhbGxldCAgcGFzc3dvcmQsIGVuY3J5cHRlZCBjbGllbnQtc2lkZSAnICtcbiAgICAgICAgJ3dpdGggYSBrZXkgaGVsZCBieVxcclxcbkJpdEdvLicsXG4gICAgICBkYXRhOiBlbmNyeXB0ZWRXYWxsZXRQYXNzY29kZSxcbiAgICB9LFxuICB9O1xuXG4gIGlmICh3YWxsZXRLZXlJRCkge1xuICAgIHFyRGF0YS51c2VyLmtleUlEID0gd2FsbGV0S2V5SUQ7XG4gIH1cblxuICBpZiAoYmFja3VwS2V5SUQpIHtcbiAgICBxckRhdGEuYmFja3VwLmtleUlEID0gYmFja3VwS2V5SUQ7XG4gIH1cblxuICBpZiAoaXNVbmRlZmluZWQodXNlcktleWNoYWluLmVuY3J5cHRlZFBydikpIHtcbiAgICAvLyBVc2VyIHByb3ZpZGVkIHRoZWlyIG93biBrZXkgLSB0aGlzIGlzIGEgY29sZCB3YWxsZXRcbiAgICBxckRhdGEudXNlci50aXRsZSA9ICdBOiBQcm92aWRlZCBVc2VyIEtleSc7XG4gICAgcXJEYXRhLnVzZXIuZGVzYyA9ICdUaGlzIGlzIHRoZSBwdWJsaWMga2V5IHlvdSBwcm92aWRlZCBmb3IgeW91ciB3YWxsZXQuJztcbiAgICBxckRhdGEudXNlci5kYXRhID0gdXNlcktleWNoYWluLnB1YjtcblxuICAgIC8vIFRoZSB1c2VyIHByb3ZpZGVkIHRoZWlyIG93biBwdWJsaWMga2V5LCB3ZSBjYW4gcmVtb3ZlIGJveCBEXG4gICAgZGVsZXRlIHFyRGF0YS5wYXNzY29kZTtcbiAgfSBlbHNlIGlmIChpc1VuZGVmaW5lZChlbmNyeXB0ZWRXYWxsZXRQYXNzY29kZSkpIHtcbiAgICBkZWxldGUgcXJEYXRhLnBhc3Njb2RlO1xuICB9XG5cbiAgaWYgKCFpc1VuZGVmaW5lZChiYWNrdXBLZXljaGFpbi5wcm92aWRlcikpIHtcbiAgICBjb25zdCBiYWNrdXBLZXlQcm92aWRlck5hbWUgPSBiYWNrdXBLZXljaGFpbi5wcm92aWRlcjtcbiAgICAvLyBCYWNrdXAga2V5IGhlbGQgd2l0aCBLUlNcbiAgICBxckRhdGEuYmFja3VwID0ge1xuICAgICAgdGl0bGU6ICdCOiBCYWNrdXAgS2V5JyxcbiAgICAgIGRlc2M6XG4gICAgICAgIGBUaGlzIGlzIHRoZSBwdWJsaWMga2V5IGhlbGQgYXQgJHtiYWNrdXBLZXlQcm92aWRlck5hbWV9YCArXG4gICAgICAgIGAsIGFuICR7Y29pblNob3J0TmFtZX0gcmVjb3Zlcnkgc2VydmljZS4gSWYgeW91IGxvc2VcXHJcXG55b3VyIGtleSwgJHtiYWNrdXBLZXlQcm92aWRlck5hbWV9YCArXG4gICAgICAgICcgd2lsbCBiZSBhYmxlIHRvIHNpZ24gdHJhbnNhY3Rpb25zIHRvIHJlY292ZXIgZnVuZHMuJyxcbiAgICAgIGRhdGE6IGJhY2t1cEtleWNoYWluLnB1YixcbiAgICB9O1xuICB9IGVsc2UgaWYgKGlzVW5kZWZpbmVkKGJhY2t1cEtleWNoYWluLmVuY3J5cHRlZFBydikpIHtcbiAgICAvLyBVc2VyIHN1cHBsaWVkIHRoZSB4cHViXG4gICAgcXJEYXRhLmJhY2t1cCA9IHtcbiAgICAgIHRpdGxlOiAnQjogQmFja3VwIEtleScsXG4gICAgICBkZXNjOiAnVGhpcyBpcyB0aGUgcHVibGljIHBvcnRpb24gb2YgeW91ciBiYWNrdXAga2V5LCB3aGljaCB5b3UgcHJvdmlkZWQuJyxcbiAgICAgIGRhdGE6IGJhY2t1cEtleWNoYWluLnB1YixcbiAgICB9O1xuICB9XG5cblxuICByZXR1cm4gcXJEYXRhO1xufVxuXG5pbnRlcmZhY2UgRHJhd0tleWNhcmRPcHRpb25zIGV4dGVuZHMgR2V0S2V5RGF0YU9wdGlvbnMge1xuICBqc1BERjogYW55O1xuICBRUkNvZGU6IGFueTtcbiAgY29pblNob3J0TmFtZTogc3RyaW5nO1xuICBhY3RpdmF0aW9uQ29kZTogc3RyaW5nO1xuICB3YWxsZXRMYWJlbDogc3RyaW5nO1xuICBjb2luTmFtZTogc3RyaW5nO1xufVxuXG4vKipcbiAqIERyYXcgYSBrZXljYXJkIGludG8gYSBuZXcgcGRmIGRvY3VtZW50IG9iamVjdFxuICogQHBhcmFtIG9wdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRyYXdLZXljYXJkKG9wdGlvbnM6IERyYXdLZXljYXJkT3B0aW9ucyk6IGFueSB7XG4gIGNvbnN0IHtcbiAgICBqc1BERixcbiAgICBRUkNvZGUsXG4gICAgY29pblNob3J0TmFtZSxcbiAgICBhY3RpdmF0aW9uQ29kZSxcbiAgICB3YWxsZXRMYWJlbCxcbiAgICBjb2luTmFtZSxcbiAgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgbWFyZ2luID0gMzA7XG5cbiAgY29uc3QgZm9udCA9IHtcbiAgICBoZWFkZXI6IDI0LFxuICAgIHN1YmhlYWRlcjogMTUsXG4gICAgYm9keTogMTJcbiAgfTtcblxuICBjb25zdCBjb2xvciA9IHtcbiAgICBibGFjazogJyMwMDAwMDAnLFxuICAgIGRhcmtncmF5OiAnIzRjNGM0YycsXG4gICAgZ3JheTogJyM5YjliOWInLFxuICAgIHJlZDogJyNlMjFlMWUnXG4gIH07XG5cbiAgLy8gZG9jdW1lbnQgZGV0YWlsc1xuICBjb25zdCB3aWR0aCA9IDguNSAqIDcyO1xuICBsZXQgeSA9IDA7XG5cbiAgLy8gSGVscGVycyBmb3IgZGF0YSBmb3JtYXR0aW5nIC8gcG9zaXRpb25pbmcgb24gdGhlIHBhcGVyXG4gIGNvbnN0IGxlZnQgPSAoeCkgPT4gbWFyZ2luICsgeDtcbiAgY29uc3QgbW92ZURvd24gPSAoeURlbHRhKSA9PiB7IHkgKz0geURlbHRhOyB9O1xuXG4gIGNvbnN0IGRvYyA9IG5ldyBqc1BERigncG9ydHJhaXQnLCAncHQnLCAnbGV0dGVyJyk7XG4gIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnKTtcblxuICAvLyBQREYgSGVhZGVyIEFyZWEgLSBpbmNsdWRlcyB0aGUgbG9nbyBhbmQgY29tcGFueSBuYW1lXG4gIC8vIFRoaXMgaXMgZGF0YSBmb3IgdGhlIEJpdEdvIGxvZ28gaW4gdGhlIHRvcCBsZWZ0IG9mIHRoZSBQREZcbiAgbW92ZURvd24oMzApO1xuXG4gIC8vIFdlIGRvbid0IGN1cnJlbnRseSBhZGQgYW4gaW1hZ2UsIHNpbmNlIHRoYXQgcGF0aCBpcyBkZXBlbmRlbnQgb24gQml0R28gZnJvbnRlbmRcbiAgLy8gZG9jLmFkZEltYWdlKGNvaW5VdGlsaXR5LmdldFNlbGVjdGVkQ29pbk9iaigpLmtleUNhcmRJbWFnZSwgbGVmdCgwKSwgeSArIDEwKTtcblxuICAvLyBBY3RpdmF0aW9uIENvZGVcbiAgbW92ZURvd24oOCk7XG4gIGRvYy5zZXRGb250U2l6ZShmb250LmJvZHkpLnNldFRleHRDb2xvcihjb2xvci5ncmF5KTtcbiAgZG9jLnRleHQoJ0FjdGl2YXRpb24gQ29kZScsIGxlZnQoNDYwKSwgeSk7XG5cbiAgZG9jLnNldEZvbnRTaXplKGZvbnQuaGVhZGVyKS5zZXRUZXh0Q29sb3IoY29sb3IuYmxhY2spO1xuICBtb3ZlRG93bigyNSk7XG4gIGRvYy50ZXh0KCdZb3VyIEJpdEdvIEtleUNhcmQnLCBsZWZ0KDE1MCksIHkpO1xuICBkb2Muc2V0Rm9udFNpemUoZm9udC5oZWFkZXIpLnNldFRleHRDb2xvcihjb2xvci5ncmF5KTtcbiAgZG9jLnRleHQoYWN0aXZhdGlvbkNvZGUudG9TdHJpbmcoKSwgbGVmdCg0NjApLCB5KTtcblxuICAvLyBTdWJoZWFkZXJcbiAgLy8gdGl0bGVzXG4gIG1vdmVEb3duKG1hcmdpbik7XG4gIGRvYy5zZXRGb250U2l6ZShmb250LmJvZHkpLnNldFRleHRDb2xvcihjb2xvci5ncmF5KTtcbiAgZG9jLnRleHQoYENyZWF0ZWQgb24gJHtuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpfSBieSAke3dpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZX0gZm9yIHdhbGxldCBuYW1lZCAke3dhbGxldExhYmVsfWAsIGxlZnQoMCksIHkpO1xuICAvLyBjb3B5XG4gIG1vdmVEb3duKDI1KTtcbiAgZG9jLnNldEZvbnRTaXplKGZvbnQuc3ViaGVhZGVyKS5zZXRUZXh0Q29sb3IoY29sb3IuYmxhY2spO1xuICBkb2MudGV4dCh3YWxsZXRMYWJlbCwgbGVmdCgwKSwgeSk7XG4gIC8vIFJlZCBCYXJcbiAgbW92ZURvd24oMjApO1xuICBkb2Muc2V0RmlsbENvbG9yKDI1NSwgMjMwLCAyMzApO1xuICBkb2MucmVjdChsZWZ0KDApLCB5LCB3aWR0aCAtIDIgKiBtYXJnaW4sIDMyLCAnRicpO1xuXG4gIC8vIHdhcm5pbmcgbWVzc2FnZVxuICBtb3ZlRG93bigyMCk7XG4gIGRvYy5zZXRGb250U2l6ZShmb250LmJvZHkpLnNldFRleHRDb2xvcihjb2xvci5yZWQpO1xuICBkb2MudGV4dCgnUHJpbnQgdGhpcyBkb2N1bWVudCwgb3Iga2VlcCBpdCBzZWN1cmVseSBvZmZsaW5lLiBTZWUgc2Vjb25kIHBhZ2UgZm9yIEZBUS4nLCBsZWZ0KDc1KSwgeSk7XG5cbiAgY29uc3Qge1xuICAgIGVuY3J5cHQsXG4gICAgcGFzc3BocmFzZSxcbiAgICBwYXNzY29kZUVuY3J5cHRpb25Db2RlLFxuICAgIHdhbGxldEtleUlELFxuICAgIGJhY2t1cEtleUlELFxuICAgIHVzZXJLZXljaGFpbixcbiAgICBiaXRnb0tleWNoYWluLFxuICAgIGJhY2t1cEtleWNoYWluLFxuICB9ID0gb3B0aW9ucztcblxuICAvLyBHZXQgdGhlIGRhdGEgZm9yIHRoZSBmaXJzdCBwYWdlIChxciBjb2RlcylcbiAgY29uc3Qga2V5RGF0YSA9IGdldEtleURhdGEoe1xuICAgIGVuY3J5cHQsXG4gICAgY29pblNob3J0TmFtZSxcbiAgICBwYXNzcGhyYXNlLFxuICAgIHBhc3Njb2RlRW5jcnlwdGlvbkNvZGUsXG4gICAgd2FsbGV0S2V5SUQsXG4gICAgYmFja3VwS2V5SUQsXG4gICAgdXNlcktleWNoYWluLFxuICAgIGJpdGdvS2V5Y2hhaW4sXG4gICAgYmFja3VwS2V5Y2hhaW4sXG4gIH0pO1xuXG4gIC8vIEdlbmVyYXRlIHRoZSBmaXJzdCBwYWdlJ3MgZGF0YSBmb3IgdGhlIGJhY2t1cCBQREZcbiAgbW92ZURvd24oMzUpO1xuICBjb25zdCBxclNpemUgPSAxMzA7XG5cbiAgLy8gRHJhdyBlYWNoIEJveCB3aXRoIFFSIGNvZGUgYW5kIGRlc2NyaXB0aW9uXG4gIE9iamVjdC5rZXlzKGtleURhdGEpLmZvckVhY2goZnVuY3Rpb24oa2V5VHlwZSkge1xuICAgIGNvbnN0IGtleSA9IGtleURhdGFba2V5VHlwZV07XG4gICAgY29uc3QgdG9wWSA9IHk7XG5cbiAgICAvLyBEb24ndCBpbmRlbnQgaWYgd2UncmUgbm90IHByb2R1Y2luZyBRUiBjb2Rlc1xuICAgIGNvbnN0IHRleHRMZWZ0ID0gISFRUkNvZGUgPyBsZWZ0KHFyU2l6ZSArIDE1KSA6IGxlZnQoMTUpO1xuXG4gICAgLy8gRHJhdyBhIFFSIGNvZGUgaWYgbGlicmFyeSBpcyBhdmFpbGFibGVcbiAgICBpZiAoUVJDb2RlKSB7XG4gICAgICBjb25zdCBkYXRhVVJMID0gbmV3IFFSQ29kZSh7IHZhbHVlOiBrZXkuZGF0YSwgc2l6ZTogcXJTaXplIH0pLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycpO1xuICAgICAgZG9jLmFkZEltYWdlKGRhdGFVUkwsIGxlZnQoMCksIHksIHFyU2l6ZSwgcXJTaXplKTtcbiAgICB9XG5cbiAgICBkb2Muc2V0Rm9udFNpemUoZm9udC5zdWJoZWFkZXIpLnNldFRleHRDb2xvcihjb2xvci5ibGFjayk7XG4gICAgbW92ZURvd24oMTApO1xuICAgIGRvYy50ZXh0KGtleS50aXRsZSwgdGV4dExlZnQsIHkpO1xuICAgIG1vdmVEb3duKDE1KTtcbiAgICBkb2Muc2V0Rm9udFNpemUoZm9udC5ib2R5KS5zZXRUZXh0Q29sb3IoY29sb3IuZGFya2dyYXkpO1xuICAgIGRvYy50ZXh0KGtleS5kZXNjLCB0ZXh0TGVmdCwgeSk7XG4gICAgbW92ZURvd24oMzApO1xuICAgIGRvYy5zZXRGb250U2l6ZShmb250LmJvZHkgLSAyKTtcbiAgICBkb2MudGV4dCgnRGF0YTonLCB0ZXh0TGVmdCwgeSk7XG4gICAgbW92ZURvd24oMTUpO1xuICAgIGNvbnN0IGlubmVyV2lkdGggPSA3MiAqIDguNSAtIHRleHRMZWZ0IC0gMzA7XG4gICAgZG9jLnNldEZvbnQoJ2NvdXJpZXInKS5zZXRGb250U2l6ZSg5KS5zZXRUZXh0Q29sb3IoY29sb3IuYmxhY2spO1xuICAgIGNvbnN0IGxpbmVzID0gZG9jLnNwbGl0VGV4dFRvU2l6ZShrZXkuZGF0YSwgaW5uZXJXaWR0aCk7XG4gICAgZG9jLnRleHQobGluZXMsIHRleHRMZWZ0LCB5KTtcblxuICAgIC8vIEFkZCBrZXkgSUQgKGRlcml2YXRpb24gc3RyaW5nKSBpZiBpdCBleGlzdHNcbiAgICBpZiAoa2V5LmtleUlEKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gJ0tleSBJZDogJyArIGtleS5rZXlJRDtcbiAgICAgIC8vIEdyYXkgYmFyXG4gICAgICBtb3ZlRG93big0NSk7XG4gICAgICBkb2Muc2V0RmlsbENvbG9yKDI0NywgMjQ5LCAyNDkpOyAvLyBHcmF5IGJhY2tncm91bmRcbiAgICAgIGRvYy5zZXREcmF3Q29sb3IoMCwgMCwgMCk7IC8vIEJvcmRlclxuICAgICAgZG9jLnJlY3QodGV4dExlZnQsIHksIHdpZHRoLCAxNSwgJ0ZEJyk7XG5cbiAgICAgIGRvYy50ZXh0KHRleHQsIHRleHRMZWZ0ICsgNSwgeSArIDEwKTtcbiAgICB9XG5cbiAgICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJyk7XG4gICAgLy8gTW92ZSBkb3duIHRoZSBzaXplIG9mIHRoZSBRUiBjb2RlIG1pbnVzIGFjY3VtdWxhdGVkIGhlaWdodCBvbiB0aGUgcmlnaHQgc2lkZSwgcGx1cyBidWZmZXJcbiAgICBtb3ZlRG93bihxclNpemUgLSAoeSAtIHRvcFkpICsgMTUpO1xuICB9KTtcblxuICAvLyBBZGQgYSBuZXcgcGFnZSAoUSArIEEgcGFnZSlcbiAgZG9jLmFkZFBhZ2UoKTtcblxuICAvLyAybmQgcGFnZSB0aXRsZVxuICB5ID0gMDtcbiAgbW92ZURvd24oNTUpO1xuICBkb2Muc2V0Rm9udFNpemUoZm9udC5oZWFkZXIpLnNldFRleHRDb2xvcihjb2xvci5ibGFjayk7XG4gIGRvYy50ZXh0KCdCaXRHbyBLZXlDYXJkIEZBUScsIGxlZnQoMCksIHkpO1xuXG4gIGNvbnN0IHF1ZXN0aW9ucyA9IGdlbmVyYXRlUXVlc3Rpb25zKGNvaW5OYW1lKTtcblxuICAvLyBEcmF3IHRoZSBRICsgQSBkYXRhIG9uIHRoZSBzZWNvbmQgcGFnZVxuICBtb3ZlRG93bigzMCk7XG4gIHF1ZXN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHEpIHtcbiAgICBkb2Muc2V0Rm9udFNpemUoZm9udC5zdWJoZWFkZXIpLnNldFRleHRDb2xvcihjb2xvci5ibGFjayk7XG4gICAgZG9jLnRleHQocS5xLCBsZWZ0KDApLCB5KTtcbiAgICBtb3ZlRG93bigyMCk7XG4gICAgZG9jLnNldEZvbnRTaXplKGZvbnQuYm9keSkuc2V0VGV4dENvbG9yKGNvbG9yLmRhcmtncmF5KTtcbiAgICBxLmEuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7XG4gICAgICBkb2MudGV4dChsaW5lLCBsZWZ0KDApLCB5KTtcbiAgICAgIG1vdmVEb3duKGZvbnQuYm9keSArIDMpO1xuICAgIH0pO1xuICAgIG1vdmVEb3duKDIyKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGRvYztcbn1cbiJdfQ==